{
  "name": "AI Learning Agent - Medium to Audio",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 7 * * *"
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Daily 7 AM Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [0, 0]
    },
    {
      "parameters": {
        "url": "https://medium.com/feed/tag/data-engineering",
        "options": {
          "response": {
            "response": {
              "responseFormat": "text"
            }
          }
        }
      },
      "id": "fetch-rss",
      "name": "Fetch Medium RSS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [220, 0]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Parse RSS XML and extract articles\nconst xmlData = $input.first().json.data;\n\n// Simple XML parsing for RSS items\nconst items = [];\nconst itemRegex = /<item>(.*?)<\\/item>/gs;\nlet match;\n\nwhile ((match = itemRegex.exec(xmlData)) !== null) {\n  const itemXml = match[1];\n  \n  const getTag = (xml, tag) => {\n    const regex = new RegExp(`<${tag}[^>]*><!\\\\[CDATA\\\\[(.+?)\\\\]\\\\]><\\\\/${tag}>|<${tag}[^>]*>(.+?)<\\\\/${tag}>`, 's');\n    const m = xml.match(regex);\n    return m ? (m[1] || m[2] || '').trim() : '';\n  };\n  \n  items.push({\n    title: getTag(itemXml, 'title'),\n    link: getTag(itemXml, 'link'),\n    pubDate: getTag(itemXml, 'pubDate'),\n    content: getTag(itemXml, 'content:encoded') || getTag(itemXml, 'description'),\n    guid: getTag(itemXml, 'guid')\n  });\n}\n\n// Return first 20 articles for filtering\nreturn items.slice(0, 20).map(item => ({ json: item }));"
      },
      "id": "parse-rss",
      "name": "Parse RSS Feed",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 0]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Check if article was already processed using n8n static data\nconst staticData = $getWorkflowStaticData('global');\n\n// Initialize processed array if not exists\nif (!staticData.processed) {\n  staticData.processed = [];\n}\n\nconst items = $input.all();\n\n// Filter out already processed articles\nconst newItems = items.filter(item => {\n  const guid = item.json.guid || item.json.link;\n  return !staticData.processed.includes(guid);\n});\n\n// If no new articles, return skip flag\nif (newItems.length === 0) {\n  return [{ json: { skip: true, message: 'No new articles found' } }];\n}\n\n// Return only the FIRST unprocessed article\nreturn [newItems[0]];"
      },
      "id": "filter-processed",
      "name": "Filter Processed",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 0]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.skip }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-skip",
      "name": "Has New Article?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [880, 0]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Clean HTML content to plain text\nconst item = $input.first().json;\n\nlet content = item.content || '';\n\n// Remove HTML tags but keep text\ncontent = content\n  .replace(/<script[^>]*>.*?<\\/script>/gi, '')\n  .replace(/<style[^>]*>.*?<\\/style>/gi, '')\n  .replace(/<[^>]+>/g, ' ')\n  .replace(/&nbsp;/g, ' ')\n  .replace(/&amp;/g, '&')\n  .replace(/&lt;/g, '<')\n  .replace(/&gt;/g, '>')\n  .replace(/&quot;/g, '\"')\n  .replace(/&#39;/g, \"'\")\n  .replace(/\\s+/g, ' ')\n  .trim();\n\n// Limit content length (approx 3000 words max)\nconst words = content.split(' ');\nif (words.length > 3000) {\n  content = words.slice(0, 3000).join(' ') + '...';\n}\n\nreturn [{\n  json: {\n    title: item.title,\n    link: item.link,\n    guid: item.guid || item.link,\n    content: content,\n    wordCount: words.length\n  }\n}];"
      },
      "id": "extract-content",
      "name": "Extract Content",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, -100]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "={{ $env.ANTHROPIC_API_KEY }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-3-haiku-20240307\",\n  \"max_tokens\": 1024,\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"You are my personal AI tutor.\\n\\nI am a Senior Data Engineer learning advanced systems and AI.\\n\\nExplain this Medium article in a simple way, then connect it to real-world data pipelines, Snowflake, Spark, Airflow, and cloud systems.\\n\\nRules:\\n- Beginner-friendly language\\n- Practical and actionable insights\\n- No fluff or filler content\\n- Include real examples\\n- Keep it under 3 minutes when read aloud (approximately 450-500 words)\\n\\nStructure your response exactly as follows:\\n\\n1. SIMPLE OVERVIEW (60-80 words)\\nStart with \\\"Today we're learning about...\\\" and give a clear, simple explanation.\\n\\n2. HOW THIS FITS IN REAL PIPELINES (100-120 words)\\nConnect this to actual data pipeline work with Snowflake, Spark, Airflow, or cloud platforms.\\n\\n3. EXAMPLE FROM INDUSTRY (80-100 words)\\nGive one concrete example of how a company might use this.\\n\\n4. KEY LESSON (40-60 words)\\nEnd with \\\"The key lesson here is...\\\" - make it memorable and actionable.\\n\\n---\\n\\nARTICLE TO EXPLAIN:\\n\\nTitle: {{ $json.title }}\\n\\nContent:\\n{{ $json.content }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "id": "ai-simplify",
      "name": "Claude AI Simplify",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1320, -100]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Extract the AI response text\nconst response = $input.first().json;\nconst explanation = response.content[0].text;\n\nreturn [{\n  json: {\n    explanation: explanation,\n    title: $('Extract Content').item.json.title,\n    link: $('Extract Content').item.json.link,\n    guid: $('Extract Content').item.json.guid\n  }\n}];"
      },
      "id": "parse-claude-response",
      "name": "Parse Claude Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1540, -100]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://tts-service:8100/synthesize",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"text\": {{ JSON.stringify($json.explanation) }},\n  \"voice\": \"en-US-AriaNeural\"\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "id": "text-to-speech",
      "name": "Edge TTS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1760, -100]
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "binaryData": true,
        "binaryPropertyName": "data",
        "additionalFields": {
          "caption": "=ðŸ“š *{{ $('Parse Claude Response').item.json.title }}*\n\nðŸ”— [Read original]({{ $('Parse Claude Response').item.json.link }})"
        }
      },
      "id": "send-audio",
      "name": "Send Audio to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [1980, -100],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "text": "=ðŸ“ *Summary*\n\n{{ $('Parse Claude Response').item.json.explanation }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "send-summary",
      "name": "Send Text Summary",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [2200, -100],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Save processed article to n8n static data\nconst staticData = $getWorkflowStaticData('global');\n\n// Initialize if not exists\nif (!staticData.processed) {\n  staticData.processed = [];\n}\n\n// Add new article GUID\nconst guid = $('Parse Claude Response').item.json.guid;\nif (!staticData.processed.includes(guid)) {\n  staticData.processed.push(guid);\n}\n\n// Keep only last 100 articles\nif (staticData.processed.length > 100) {\n  staticData.processed = staticData.processed.slice(-100);\n}\n\nreturn [{ json: { success: true, processed: staticData.processed.length } }];"
      },
      "id": "log-processed",
      "name": "Log Processed Article",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2420, -100]
    },
    {
      "parameters": {},
      "id": "no-op",
      "name": "No New Articles",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1100, 100]
    }
  ],
  "connections": {
    "Daily 7 AM Trigger": {
      "main": [
        [
          {
            "node": "Fetch Medium RSS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Medium RSS": {
      "main": [
        [
          {
            "node": "Parse RSS Feed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse RSS Feed": {
      "main": [
        [
          {
            "node": "Filter Processed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Processed": {
      "main": [
        [
          {
            "node": "Has New Article?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has New Article?": {
      "main": [
        [
          {
            "node": "No New Articles",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Content": {
      "main": [
        [
          {
            "node": "Claude AI Simplify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude AI Simplify": {
      "main": [
        [
          {
            "node": "Parse Claude Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Claude Response": {
      "main": [
        [
          {
            "node": "Edge TTS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edge TTS": {
      "main": [
        [
          {
            "node": "Send Audio to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Audio to Telegram": {
      "main": [
        [
          {
            "node": "Send Text Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Text Summary": {
      "main": [
        [
          {
            "node": "Log Processed Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "learning",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "triggerCount": 1,
  "pinData": {}
}
